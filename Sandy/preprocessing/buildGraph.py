
import networkx as nx
import matplotlib.pyplot as plt
import seaborn as sb

class ProcNetwork:

    def __init__(self, df_obj):
        self.object = df_obj

    def produce_edge_list(self, source, target):
        self.network = nx.from_pandas_edgelist(self.object,
                                               source=source,
                                               target=target,
                                               edge_attr=True)

    def assign_labels(self, label_name='ProcName'):
        labels = dict(zip(self.network.nodes(), self.object[label_name]))
        self.network = nx.relabel_nodes(self.network, labels)


    def assign_attribute(self, attr_name):
        attr = dict(zip(self.network.nodes(), self.object[attr_name]))
        nx.set_node_attributes(self.network, attr, 'NodeAttr')

        self.attr_colors = create_color_map(self.network, 'NodeAttr')


    def plot_network(self, save=False, map_feature=False):

        fig = plt.figure()
        layout = nx.spring_layout(self.network)
        n_colors = 'blue' #Default nodes to blue

        if map_feature:
            n_colors = self.attr_colors

        nx.draw_networkx_nodes(self.network,pos=layout,
                               node_size=10,alpha=1,node_color=n_colors)
        nx.draw_networkx_edges(self.network,pos=layout,
                               width=1,style='dotted',edge_color='red')
        nx.draw_networkx_labels(self.network,pos=layout,
                                font_size=4)

        plt.show()

        if save:
            fig.savefig('figure.png', format='png', dpi=1000, bbox_inches = 'tight')

    def _columns(self):
        return self.object.columns


def create_color_map(G, attrib, sb_palette="RdBu_r"):
    """
    Code retrieved from Networkx Youtube video at PyData2016
    """

    attributes = [G.node[label][attrib] for label in G.nodes()]

    attributes_unique = list(set(attributes))
    num_values = len(attributes_unique)

    palette = sb.color_palette(sb_palette, num_values).as_hex()
    color_map = dict(zip(attributes_unique, palette))
    node_colors = [color_map[attribute] for attribute in attributes]

    return node_colors


## Set Parameters
#source =
#target =
